[TOC]
# 第五章：操作系统  
## 认识操作系统  
### 计算机系统层次  
硬件、系统软件（操作系统、驱动程序）、应用软件  
### 计算机的启动过程  
1. 启动自检阶段  
2. 初始化启动阶段  
3. 启动加载阶段  
4. 内核装载阶段  
5. 登陆阶段  
### 操作系统  
操作系统(OS, Operating System )：是控制和管理计算机系统内各种硬件和软件资源、合理有效地组织计算机系统的工作，为用户提供一个使用方便可扩展的工作环境，从而起到连接计算机和用户的接口作用。  
## 操作系统分类  
### - 批处理操作系统  
批处理操作系统——批处理是指计算机系统对一批作业自动进行处理的技术。 由于系统资源为多个作业所共享，其工作方式是作业之间自动调度执行。并在运行过程中用户不干预自己的作业，从而大大提高了系统资源的利用率和作业吞吐量。  
### - 分时操作系统  
分时操作系统——将计算机系统的CPU时间划分成一些小的时间片，按时间片轮流把处理机分给各联机作业使用。  
#### 分时操作系统的特点  
- 交互性：用户与系统进行人机对话。  
- 多路性：多用户同时在各自终端上使用同一CPU。  
- 独立性：用户可彼此独立操作，互不干扰，互不混淆。  
- 及时性：用户在短时间内可得到系统的及时回答。  
### - 实时操作系统  
- 实时操作系统——所谓"实时",即"及时",是指系统能及时(或即时)响应外部 事件的请求,在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。它必须保证实时性和高可靠性，对系统的效率则放在第二位。  
- 主要应用于工业控制、军事控制、电子设备等领域。  
### - 嵌入式操作系统  
- 嵌入式操作系统通常包括与硬件相关的底层驱动软件、系统内核、设备驱动接口、通信协议、图形界面、标准化浏览器等。  
- 嵌入式操作系统负责嵌入式系统的全部软、硬件资源的分配、任务调度，控制、协调并发活动。它必须体现其所在系统的特征，能够通过装卸某些模块来达到系统所要求的功能。  
- 目前在嵌入式领域广泛使用的操作系统有：嵌入式Linux、Windows Embedded、VxWorks等，以及应用在智能手机和平板电脑的Android、iOS等。  
## 操作系统对硬件的管理  
### 处理器的管理  
CPU管理：为了满足系统的性能要求，提高任务处理的效率，现在主流的计算机通常都有一个或多个CPU，每个CPU中又有多个核。然而核的数量是远远小于需要执行的程序的数量。
多任务在同一个核上进行执行：
- 分时间片  
- 中断（进程）  
- 调度（调度策略）  
#### 进程  
##### 定义：是一个程序的一次执行，包含了其执行时所有的环境信息。（进程是执行中的程序）  
##### 进程的特征：（与程序比较）
1. 结构特征：进程控制块（PCB）+程序+数据=进程实体  
2. 动态性***最基本的特征***  
进程：进程实体的一次执行过程，有生命周期。  
程序：程序是一组有序指令的集合，是静态的概念。  
3. 并发性  
4. 独立性  
5. 异步性  
##### 进程的三种状态：  
- 就绪状态(Ready)：进程已获得除处理机之外的所有必需的资源，一旦得到处理机CPU控制权，立即可以运行。  
- 运行状态(Running)：进程已获得运行所必需的资源，它的程序正在处理机上执行。  
- 阻塞状态(Blocked)：正在执行的进程由于发生某事件而暂时无法执行时，便放弃处理机而处于暂停状态，称该进程处于阻塞状态或等待状态。  
- 三种状态转换  
![三种状态的转化](D:\Github客户端\My Github\Leocomputer\计算机导论\图片\三种状态的转换.png)  
##### 三级调度  
- 高级调度（High Scheduling）  
又称为作业调度或长程调度（Long-Term Scheduling），用于决定把外存上处于后备队列中的哪些作业调入内存，并为它们创建进程、分配必要的资源，然后将新创建的进程排在就绪队列上，准备执行。在批处理系统中，因作业进入系统后先驻留在外存，故需要有作业调度。在分时系统中为做到及时响应，作业被直接送入内存，故不需作业调度。在实时系统中，通常也不需作业调度。  
- 低级调度（Low Level Scheduling）  
通常也称为***进程调度***或短程调度（Short-Term Scheduling），用来决定就绪队列中的哪个进程应获得处理机，然后再由分派程序把处理机分配给该进程。为最基本的一种调度，三种OS中都有。  ***进程调度可采用下述两种调度方式：
非抢占方式（Non-preemptive Mode）
抢占方式（Preemptive Mode）***  
- 中级调度（Low Level Scheduling）
又称中程调度（Medium-Term Scheduling）。引入目的是为了提高内存利用率和系统吞吐量。为此，应使那些暂时不能运行的进程不再占用宝贵的内存资源，而将它们调至外存去等待，把此时的进程状态称为就绪驻外存状态或挂起状态。当这些进程重又具备运行条件、且内存又稍有空闲时，由中级调度来决定把外存上的哪些又具备运行条件的就绪进程，重新调入内存，并修改其状态为就绪状态，挂在就绪队列上等待进程调度。  
###### OS设计目标  
1. 处理机调度算法的共同目标  
- 资源利用率  
- 公平性  
- 平衡性  
- 策略强制执行  
2. 批处理系统的目标  
- 周转时间短：包括周转时间、平均周转时间、带权周转时间、平均带权周转时间*把握理解定义*  
- 系统吞吐量高  
- 处理机利用率好  
3. 分时系统的目标  
- 响应时间快：      响应时间  
- 均衡性  
4. 实时系统的目标  
- 截止时间的保证：截止时间  
- 可预测性  
###### 进程调度  
调度程序：按照调度策略，动态地把CPU分配给处于就绪队列中的进程，并将该进程从就绪态转换到运行状态。  
对于不同的系统和系统目标，通常采用不同的调度算法。衡量调度策略的好坏，一个重要的指标是：周转时间（平均周转时间）  
- 先来先服务调度算法（FCFS）  
![先来先服务](D:\Github客户端\My Github\Leocomputer\计算机导论\图片\先来先服务.png)
先来先服务调度（FCFS）调度算法的特点：  
FCFS调度算法有利于CPU繁忙型的作业，而不利于I/O繁忙型的作业（进程）  
**CPU繁忙型作业：如通常的科学计算。  
I/O繁忙型作业：指CPU进行处理时，需频繁的请求I/O。**  
- 短任务优先调度算法（SJF）  
![短作业优先](D:\Github客户端\My Github\Leocomputer\计算机导论\图片\短作业优先.png)
短作业优先调度（SJF）调度算法的优缺点：  
优点：有效降低作业的平均等待时间，提高系统吞吐量。  
缺点：  
1. 对长作业不利。  
2. 该算法完全未考虑作业的紧迫程度，因而不能保证紧迫性作业（进程）会被及时处理。  
3. 由于作业（进程）的长短含主观因素，不一定能真正做到短作业优先。  
### 储存器的管理  
储存器管理的主要对象是内存，对外存的管理再文件管理中  
#### 储存器的层次结构  
- 多级储存器结构  
![多级储存结构](D:\Github客户端\My Github\Leocomputer\计算机导论\图片\多级储存结构.png)  
#### 装入方式  
***注意：在采用可重定位装入方式将装入模块装入内存后，会使装入模块中的所有逻辑地址与实际装入内存的物理地址不同。（比如说![举例](D:\Github客户端\My Github\Leocomputer\计算机导论\图片\举例.png)）***
##### 内存分配方式——连续分配  
连续分配方式：是指为一个用户程序分配一个连续的内存空间。
###### - 单一连续分配  
最简单的一种存储管理方式，但只能用于单用户、单任务的操作系统中。采用这种存储管理方式时，可把内存分为系统区和用户区两部分，系统区仅提供给OS使用，通常放在内存低址部分，用户区是指除系统区以外的全部内存空间，提供给用户使用。  
###### - 固定分区分配  
将内存用户空间划分为若干个固定大小的区域，在每个分区中只装入一道作业，这样把用户空间划分为几个分区，便允许有几道作业并发执行。  
- 分区大小相等：优：用途广泛，用于各种需要统一规模，统一生产的环境，用于一台计算机控制多个相同对象的场合；缺：缺乏灵活性  
- 分区大小不等：把内存区划分成含有多个较小的分区、适量的中等分区及少量的大分区，可根据程序的大小为之分配适当的分区。优：灵活性提高；缺：必须提前知道知道任务大小，以及统计好大小分区的数量和大小，工作量增大  
###### - 动态分区分配  
（按需分配，分配算法，回收分区尽可能地“合并”）  
- 动态分区分配是根据进程的实际需要，动态地为之分配内存空间。作业装入内存时，把可用内存分出一个连续区域给作业，且分区的大小正好适合作业大小的需要。分区的大小和个数依装入作业的需要而定。  
- 分区分配算法
为把一个新作业装入内存，需按照一定的分配算法，从空闲分区表或空闲分区链中选出一分区分配给该作业。
- 常用的分配算法：
-首次适应算法FF
-循环首次适应算法
-最佳适应算法
##### 内存分配方式——离散分配
- 允许将一个进程直接分散地装入许多不相邻的分区中  
-分页存储管理方式：离散分配的基本单位是页  
-分段存储管理方式：离散分配的基本单位是段  
基本的分页存储管理方式(或纯分页存储管理方式)：不具备页面对换功能，不具有支持实现虚拟存储器的功能，要求把每个作业全部装入内存后方能运行。  
###### 分页式存储管理的原理  
分页存储管理是将一个进程的逻辑地址空间分成若干个大小相等的片称为页面或页，并为各页加以编号，从0开始。同时把内存空间分成与页面相同大小的若干个存储块，称为块或页框。在为进程分配内存时，以块为单位将进程的若干个页分别装入到多个可以不相邻的物理块中。进程的最后一页经常装不满而形成“页内碎片”。  
###### 页表  
在分页系统中，允许进程的每一页离散地存储在内存的任一存储块中，为方便查找，系统为每一进程建立一张页面映像表，简称页表。页表实现了从页号到物理块号的地址映射。  
## 文件系统  
- 在现代计算机系统中，要用到大量的程序和数据，由于内存容量有限，且不能长期保存，故而平时总是把他们以文件的形式存放在外存中，需要时调入内存。  
- 但用户不能够胜任管理文件的工作，于是在OS中又增加了文件管理功能，构成一个文件系统，负责管理在外存上的文件。  
- 文件夹：计算机磁盘空间里面为了分类储存电子文件而建立独立路径的目录。  
### 目录树结构  
文件目录用于标识系统中的文件及其物理地址，供检索时使用。对目录管理的要求如下：
- 实现 "按名存取"  
- 提高对目录的检索速度  
- 文件共享  
- 允许文件重名  
### 目录查询技术  
当用户要访问一个已存文件时，系统首先利用用户提供的文件名对目录进行查询，找出该文件控制块或对应索引结点；然后根据FCB或索引结点中所记录的文件物理地址，换算出文件在磁盘上的物理位置；最后通过磁盘驱动程序，将所需文件读入内存。  
